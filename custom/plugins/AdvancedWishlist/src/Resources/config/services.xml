<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <services>

        <service id="AdvancedWishlist\Command\ExampleCommand">
            <tag name="console.command"/>
        </service>

        <service id="AdvancedWishlist\ScheduledTask\ExampleTask">
            <tag name="shopware.scheduled.task"/>
        </service>

        <service id="AdvancedWishlist\ScheduledTask\PriceMonitoringTask">
            <tag name="shopware.scheduled.task"/>
        </service>

        <service id="AdvancedWishlist\ScheduledTask\PriceMonitoringTaskHandler">
            <argument type="service" id="scheduled_task.repository"/>
            <argument type="service" id="AdvancedWishlist\Service\NotificationService"/>
            <argument type="service" id="product.repository"/>
            <argument type="service" id="logger"/>
            <tag name="messenger.message_handler"/>
        </service>

        <service id="AdvancedWishlist\Subscriber\MySubscriber">
            <tag name="kernel.event_subscriber"/>
        </service>

        <service id="AdvancedWishlist\Storefront\Controller\ExampleController" public="true">
            <call method="setContainer">
                <argument type="service" id="service_container"/>
            </call>
        </service>

        <service id="AdvancedWishlist\Core\Content\Example\SalesChannel\ExampleRoute">
            <argument type="service" id="product.repository"/>
        </service>

        <service id="AdvancedWishlist\Service\CustomFieldsInstaller">
            <argument type="service" id="custom_field_set.repository"/>
            <argument type="service" id="custom_field_set_relation.repository"/>
        </service>

    <service id="AdvancedWishlist\Core\Content\Wishlist\WishlistDefinition">
            <tag name="shopware.entity.definition" entity="wishlist" />
        </service>

        <service id="AdvancedWishlist\Core\Content\Wishlist\Aggregate\WishlistItem\WishlistItemDefinition">
            <tag name="shopware.entity.definition" entity="wishlist_item" />
        </service>

        <service id="AdvancedWishlist\Core\Content\Wishlist\Aggregate\WishlistShare\WishlistShareDefinition">
            <tag name="shopware.entity.definition" entity="wishlist_share" />
        </service>

        <service id="AdvancedWishlist\Core\Content\WishlistShareView\WishlistShareViewDefinition">
            <tag name="shopware.entity.definition" entity="wishlist_share_view" />
        </service>

        <service id="AdvancedWishlist\Core\Content\WishlistAnalytics\WishlistAnalyticsDefinition">
            <tag name="shopware.entity.definition" entity="wishlist_analytics" />
        </service>

    <service id="AdvancedWishlist\Core\Service\WishlistValidator"/>

        <service id="AdvancedWishlist\Core\Service\WishlistLimitService">
            <argument type="service" id="wishlist.repository"/>
            <argument type="service" id="wishlist_item.repository"/>
            <argument type="service" id="logger"/>
        </service>

        <!-- Redis Cache Adapter -->
        <service id="AdvancedWishlist\Core\Cache\RedisCacheAdapter">
            <argument>%env(REDIS_URL)%</argument>
            <argument>wishlist_cache</argument>
            <argument>3600</argument>
            <argument type="service" id="logger"/>
        </service>

        <service id="AdvancedWishlist\Core\Service\WishlistCacheService">
            <argument type="service" id="AdvancedWishlist\Core\Cache\RedisCacheAdapter"/>
            <argument type="service" id="logger"/>
        </service>

        <service id="AdvancedWishlist\Core\Service\WishlistCrudService">
            <argument type="service" id="wishlist.repository"/>
            <argument type="service" id="AdvancedWishlist\Core\Service\WishlistValidator"/>
            <argument type="service" id="AdvancedWishlist\Core\Service\WishlistLimitService"/>
            <argument type="service" id="AdvancedWishlist\Core\Service\WishlistCacheService"/>
            <argument type="service" id="event_dispatcher"/>
            <argument type="service" id="logger"/>
            <argument type="service" id="AdvancedWishlist\Service\ShareService"/>
        </service>

        <service id="AdvancedWishlist\Core\Service\WishlistService">
            <argument type="service" id="wishlist.repository"/>
            <argument type="service" id="AdvancedWishlist\Core\Service\WishlistValidator"/>
            <argument type="service" id="AdvancedWishlist\Core\Service\WishlistLimitService"/>
            <argument type="service" id="AdvancedWishlist\Core\Service\WishlistCacheService"/>
            <argument type="service" id="event_dispatcher"/>
            <argument type="service" id="logger"/>
            <argument type="service" id="cache.app"/>
            <argument type="service" id="AdvancedWishlist\Service\ShareService"/>
            <deprecated package="advanced-wishlist" version="1.0">The "%service_id%" service is deprecated. Use "AdvancedWishlist\Core\Service\WishlistCrudService" instead.</deprecated>
        </service>

    <service id="AdvancedWishlist\Storefront\Controller\WishlistController" public="true">
            <argument type="service" id="AdvancedWishlist\Core\Service\WishlistCrudService"/>
            <argument type="service" id="AdvancedWishlist\Core\CQRS\Query\Wishlist\GetWishlistsQueryHandler"/>
            <argument type="service" id="security.csrf.token_manager"/>
            <call method="setContainer">
                <argument type="service" id="service_container"/>
            </call>
        </service>

        <service id="AdvancedWishlist\Administration\Controller\AnalyticsController" public="true">
            <argument type="service" id="AdvancedWishlist\Service\AnalyticsService"/>
            <call method="setContainer">
                <argument type="service" id="service_container"/>
            </call>
            <tag name="controller.service_arguments"/>
        </service>

    <service id="AdvancedWishlist\Core\Content\GuestWishlist\GuestWishlistDefinition">
            <tag name="shopware.entity.definition" entity="guest_wishlist" />
        </service>

        <service id="AdvancedWishlist\Core\Content\GuestWishlistMergeLog\GuestWishlistMergeLogDefinition">
            <tag name="shopware.entity.definition" entity="guest_wishlist_merge_log" />
        </service>

    <service id="AdvancedWishlist\Core\Service\GuestIdentifierService">
            <argument type="service" id="request_stack"/>
            <argument>secret</argument>
        </service>

        <service id="AdvancedWishlist\Core\Service\GuestWishlistService">
            <argument type="service" id="guest_wishlist.repository"/>
            <argument type="service" id="wishlist.repository"/>
            <argument type="service" id="AdvancedWishlist\Core\Service\WishlistService"/>
            <argument type="service" id="AdvancedWishlist\Core\Service\GuestIdentifierService"/>
            <argument type="service" id="request_stack"/>
            <argument type="service" id="event_dispatcher"/>
            <argument type="service" id="logger"/>
            <argument>%env(SHOPWARE_GUEST_WISHLIST_TTL)%</argument>
        </service>

        <service id="AdvancedWishlist\Service\NotificationService">
            <argument type="service" id="logger"/>
        </service>

        <service id="AdvancedWishlist\Service\AnalyticsService">
            <argument type="service" id="wishlist.repository"/>
            <argument type="service" id="wishlist_share_view.repository"/>
            <argument type="service" id="wishlist_analytics.repository"/>
        </service>

        <service id="AdvancedWishlist\Service\EncryptionService">
            <argument>%env(WISHLIST_ENCRYPTION_KEY)%</argument>
        </service>

        <service id="AdvancedWishlist\Service\ShareTokenService">
            <argument>%env(WISHLIST_ENCRYPTION_KEY)%</argument>
            <deprecated package="advanced-wishlist" version="1.0">The "%service_id%" service is deprecated. Use "AdvancedWishlist\Service\EncryptionService" instead.</deprecated>
        </service>

        <service id="AdvancedWishlist\Service\ShareService">
            <argument type="service" id="wishlist_share.repository"/>
            <argument type="service" id="AdvancedWishlist\Service\EncryptionService"/>
        </service>

        <!-- Factory Pattern Implementation -->
        <service id="AdvancedWishlist\Core\Factory\WishlistFactory" />

        <!-- Strategy Pattern Implementation -->
        <service id="AdvancedWishlist\Core\Domain\Strategy\PrivateWishlistVisibilityStrategy" />
        <service id="AdvancedWishlist\Core\Domain\Strategy\PublicWishlistVisibilityStrategy" />
        <service id="AdvancedWishlist\Core\Domain\Strategy\SharedWishlistVisibilityStrategy" />
        <service id="AdvancedWishlist\Core\Factory\WishlistVisibilityStrategyFactory" />

        <!-- Domain Services -->
        <service id="AdvancedWishlist\Core\Domain\Service\WishlistVisibilityService">
            <argument type="service" id="AdvancedWishlist\Core\Factory\WishlistVisibilityStrategyFactory" />
        </service>

        <!-- CQRS Pattern Implementation -->
        <!-- Command Bus -->
        <service id="AdvancedWishlist\Core\CQRS\Command\CommandBus">
            <argument type="service" id="service_container" />
        </service>

        <service id="AdvancedWishlist\Core\CQRS\Command\CreateWishlistCommandHandler">
            <argument type="service" id="wishlist.repository" />
            <argument type="service" id="AdvancedWishlist\Core\Builder\WishlistBuilder" />
            <argument type="service" id="event_dispatcher" />
            <tag name="messenger.message_handler" />
        </service>

        <!-- Query Bus -->
        <service id="AdvancedWishlist\Core\CQRS\Query\QueryBus">
            <argument type="service" id="service_container" />
        </service>

        <service id="AdvancedWishlist\Core\CQRS\Query\GetWishlistQueryHandler">
            <argument type="service" id="wishlist.repository" />
        </service>
        
        <service id="AdvancedWishlist\Core\CQRS\Query\Wishlist\GetWishlistsQueryHandler">
            <argument type="service" id="wishlist.repository" />
            <argument type="service" id="AdvancedWishlist\Core\Service\WishlistCacheService" />
            <argument type="service" id="logger" />
        </service>

        <!-- Builder Pattern Implementation -->
        <service id="AdvancedWishlist\Core\Builder\WishlistBuilder" />

        <!-- OAuth2 Integration - TEMPORARILY DISABLED -->
        <!-- 
        <service id="AdvancedWishlist\Core\OAuth\Repository\ClientRepository" public="true" />

        <service id="AdvancedWishlist\Core\OAuth\Repository\ScopeRepository" public="true" />

        <service id="AdvancedWishlist\Core\OAuth\Repository\AccessTokenRepository" public="true" />

        <service id="AdvancedWishlist\Core\OAuth\Repository\RefreshTokenRepository" public="true" />

        <service id="AdvancedWishlist\Core\OAuth\Service\OAuth2Service" public="true">
            <argument type="service" id="AdvancedWishlist\Core\OAuth\Repository\ClientRepository" />
            <argument type="service" id="AdvancedWishlist\Core\OAuth\Repository\AccessTokenRepository" />
            <argument type="service" id="AdvancedWishlist\Core\OAuth\Repository\ScopeRepository" />
            <argument type="service" id="AdvancedWishlist\Core\OAuth\Repository\RefreshTokenRepository" />
            <argument>%kernel.project_dir%/config/jwt/private.pem</argument>
            <argument>%kernel.project_dir%/config/jwt/public.pem</argument>
            <argument>%env(OAUTH2_ENCRYPTION_KEY)%</argument>
            <argument type="service" id="logger" />
        </service>

        <service id="AdvancedWishlist\Core\OAuth\Controller\OAuth2Controller" public="true">
            <argument type="service" id="AdvancedWishlist\Core\OAuth\Service\OAuth2Service" />
            <argument type="service" id="Symfony\Bridge\PsrHttpMessage\Factory\PsrHttpFactory" />
            <argument type="service" id="Symfony\Bridge\PsrHttpMessage\Factory\HttpFoundationFactory" />
            <argument type="service" id="logger" />
            <tag name="controller.service_arguments" />
        </service>

        <service id="AdvancedWishlist\Core\OAuth\Middleware\OAuth2Middleware">
            <argument type="service" id="AdvancedWishlist\Core\OAuth\Service\OAuth2Service" />
            <argument type="service" id="Symfony\Bridge\PsrHttpMessage\Factory\PsrHttpFactory" />
            <argument type="service" id="Symfony\Bridge\PsrHttpMessage\Factory\HttpFoundationFactory" />
            <argument type="service" id="logger" />
        </service>

        <service id="AdvancedWishlist\Core\OAuth\Subscriber\OAuth2Subscriber">
            <argument type="service" id="AdvancedWishlist\Core\OAuth\Middleware\OAuth2Middleware" />
            <tag name="kernel.event_subscriber" />
        </service>
        -->

        <!-- CDN Integration -->
        <service id="AdvancedWishlist\Core\Service\CdnService">
            <argument type="service" id="Shopware\Core\System\SystemConfig\SystemConfigService"/>
            <argument type="service" id="logger"/>
        </service>

        <!-- Asset URL Decorator - TEMPORARILY DISABLED -->
        <!-- 
        <service id="AdvancedWishlist\Core\Asset\AssetUrlDecorator" decorates="shopware.asset.asset">
            <argument type="service" id="AdvancedWishlist\Core\Asset\AssetUrlDecorator.inner"/>
            <argument type="service" id="AdvancedWishlist\Core\Service\CdnService"/>
            <argument type="service" id="logger"/>
        </service>
        -->

        <!-- Database Read Replica -->
        <service id="AdvancedWishlist\Core\Database\ReadReplicaConnectionDecorator">
            <argument type="service" id="Doctrine\DBAL\Connection"/>
            <argument type="service" id="read_replica.connection" on-invalid="null"/>
            <argument type="service" id="logger"/>
        </service>

        <!-- Read Replica Connection Factory -->
        <service id="read_replica.connection.factory" class="Doctrine\DBAL\Connection">
            <factory class="Doctrine\DBAL\DriverManager" method="getConnection"/>
            <argument>%env(json:READ_REPLICA_CONNECTION)%</argument>
        </service>

        <!-- Read Replica Connection -->
        <service id="read_replica.connection" class="Doctrine\DBAL\Connection">
            <factory service="read_replica.connection.factory" method="getConnection"/>
        </service>

        <!-- Query Optimizer -->
        <service id="AdvancedWishlist\Core\Database\QueryOptimizer">
            <argument type="service" id="cache.app"/>
            <argument type="service" id="logger"/>
        </service>

        <!-- Async Processor -->
        <service id="AdvancedWishlist\Core\Async\AsyncProcessor">
            <argument type="service" id="messenger.bus.shopware"/>
            <argument type="service" id="logger"/>
        </service>

        <!-- Cache Header Subscriber -->
        <service id="AdvancedWishlist\Core\Http\CacheHeaderSubscriber">
            <argument type="service" id="logger"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <!-- Security Services -->
        <service id="AdvancedWishlist\Core\Security\SecurityService">
            <argument type="service" id="security.csrf.token_manager"/>
            <argument type="service" id="logger"/>
        </service>
        
        <service id="AdvancedWishlist\Core\Security\SecurityMonitoringService">
            <argument type="service" id="logger"/>
            <argument type="service" id="request_stack"/>
        </service>

        <service id="AdvancedWishlist\Core\Security\SecurityMonitoringSubscriber">
            <argument type="service" id="AdvancedWishlist\Core\Security\SecurityMonitoringService"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <!-- PHP 8.4 Enterprise Features -->
        
        <!-- Rate Limiting Service -->
        <service id="AdvancedWishlist\Core\Security\RateLimitService">
            <argument type="service" id="cache.app"/>
            <argument type="service" id="logger"/>
            <argument type="service" id="request_stack"/>
        </service>

        <!-- Rate Limiting Middleware -->
        <service id="AdvancedWishlist\Core\Security\RateLimitMiddleware">
            <argument type="service" id="AdvancedWishlist\Core\Security\RateLimitService"/>
            <argument type="service" id="AdvancedWishlist\Core\Security\SecurityMonitoringService"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <!-- Security Headers Subscriber -->
        <service id="AdvancedWishlist\Core\Security\SecurityHeadersSubscriber">
            <tag name="kernel.event_subscriber"/>
        </service>

        <!-- PHP 8.4 Lazy Objects Service -->
        <service id="AdvancedWishlist\Core\Performance\LazyObjectService">
            <argument type="service" id="wishlist.repository"/>
            <argument type="service" id="logger"/>
        </service>

        <!-- Enhanced Performance Monitoring -->
        <service id="AdvancedWishlist\Core\Performance\PerformanceMonitoringService">
            <argument type="service" id="logger"/>
            <argument type="service" id="request_stack"/>
        </service>

        <service id="AdvancedWishlist\Core\Performance\PerformanceMonitoringSubscriber">
            <argument type="service" id="AdvancedWishlist\Core\Performance\PerformanceMonitoringService"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <!-- Enterprise Analytics Service -->
        <service id="AdvancedWishlist\Core\Analytics\EnterpriseAnalyticsService">
            <argument type="service" id="wishlist.repository"/>
            <argument type="service" id="wishlist_item.repository"/>
            <argument type="service" id="AdvancedWishlist\Core\Performance\LazyObjectService"/>
            <argument type="service" id="cache.app"/>
            <argument type="service" id="logger"/>
        </service>

        <!-- API Versioning Services - TEMPORARILY DISABLED -->
        <!--
        <service id="AdvancedWishlist\Core\Routing\ApiVersionResolver">
            <argument type="service" id="request_stack"/>
        </service>
        -->

        <!-- V2 Controllers for API Versioning - TEMPORARILY DISABLED -->
        <!--
        <service id="AdvancedWishlist\Storefront\Controller\V2\WishlistControllerV2" public="true">
            <argument type="service" id="AdvancedWishlist\Core\Service\WishlistCrudService"/>
            <argument type="service" id="AdvancedWishlist\Core\Routing\ApiVersionResolver"/>
            <argument type="service" id="AdvancedWishlist\Core\Performance\LazyObjectService"/>
            <argument type="service" id="security.csrf.token_manager"/>
            <call method="setContainer">
                <argument type="service" id="service_container"/>
            </call>
        </service>
        -->

        <!-- Premium Features Services -->
        <service id="AdvancedWishlist\Core\Premium\LicenseService">
            <argument type="service" id="cache.app"/>
            <argument type="service" id="logger"/>
        </service>

        <service id="AdvancedWishlist\Core\Premium\FeatureGateService">
            <argument type="service" id="AdvancedWishlist\Core\Premium\LicenseService"/>
            <argument type="service" id="logger"/>
        </service>

        <!-- Multi-tenant Support -->
        <service id="AdvancedWishlist\Core\Tenant\TenantService">
            <argument type="service" id="request_stack"/>
            <argument type="service" id="cache.app"/>
            <argument type="service" id="logger"/>
        </service>

    </services>
</container>
